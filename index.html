<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="Learn English through 365 podcast conversations. Practice pronunciation with AI-powered speech recognition. Improve your English speaking skills.">
    <meta name="keywords" content="learn english, english podcast, pronunciation practice, speech recognition, ESL, english conversation">
    <meta name="author" content="English Learning">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f0f0f">
    <!-- Cache control - ensure latest version -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéß</text></svg>">
    <title>English - Learn English Through 365 Conversations</title>
    
    <!-- Performance optimizations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Defer font loading to not block render -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"></noscript>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://archive.org" crossorigin>
    <link rel="dns-prefetch" href="https://archive.org">
    
    <!-- Critical CSS inline for instant render -->
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg-primary:#0f0f0f;--bg-card:#1e1e1e;--text-primary:#fff;--accent:#6366f1}
        body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;line-height:1.6;font-display:swap}
        .container{max-width:1400px;margin:0 auto;padding:20px}
        @font-face{font-family:'Inter';font-display:swap}
    </style>
    
    <!-- Full CSS loaded async to not block render -->
    <link rel="stylesheet" href="style.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="style.css"></noscript>
    
    <!-- Chatbot CSS loaded when needed -->
    
    <!-- Preload script -->
    <link rel="preload" href="script.js" as="script">
    
    <script>
        // Defer service worker registration to not block initial load
        if ('serviceWorker' in navigator) {
            // Register after page loads and is idle
            if ('requestIdleCallback' in window) {
                requestIdleCallback(() => {
                    navigator.serviceWorker.register('./sw.js').catch(() => {});
                });
            } else {
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        navigator.serviceWorker.register('./sw.js').catch(() => {});
                    }, 1000);
                });
            }
        }
    </script>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="episodes-index.js" as="script">
    <link rel="preload" href="episodes-chunk-1.js" as="script">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" style="position: fixed; inset: 0; background: #0f0f0f; display: flex; align-items: center; justify-content: center; z-index: 9999;">
        <div style="text-align: center;">
            <div style="width: 60px; height: 60px; border: 3px solid #333; border-top: 3px solid #6366f1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
            <h2 style="color: #6366f1; font-size: 24px; font-weight: 600; margin: 0;">English</h2>
            <p style="color: #a0a0a0; font-size: 14px; margin-top: 8px;">Loading...</p>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .app-container {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .app-container.loaded {
            opacity: 1;
        }
    </style>
    
    <div class="app-container" id="appContainer">
    
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
        <span class="theme-icon">üåô</span>
    </button>
    
    <div class="container">
        <header>
            <h1 id="mainTitle" style="cursor: pointer;">English</h1>
            <p>Learn English through 365 conversations at various levels.</p>
        </header>
        
        <!-- Recently Played Section -->
        <div id="recentlyPlayed" class="recently-played" style="display: none;">
            <h3>üïí Recently Played</h3>
            <div class="recent-grid"></div>
        </div>
        
        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-wrapper">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Search episodes, vocabulary, or content..." autocomplete="off">
                <button class="search-clear" id="searchClear" style="display: none;" aria-label="Clear search">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="search-results-info" id="searchResultsInfo" style="display: none;"></div>
        </div>
        
        <div class="filter-tabs">
            <button class="filter-tab active" data-level="all">All</button>
            <button class="filter-tab" data-level="Elementary">Elementary</button>
            <button class="filter-tab" data-level="Intermediate">Intermediate</button>
            <button class="filter-tab" data-level="Upper-Intermediate">Upper-Intermediate</button>
            <button class="filter-tab" data-level="Advanced">Advanced</button>
            <button class="filter-tab" data-level="Daily Life">Daily Life</button>
            <button class="filter-tab" data-level="The Office">The Office</button>
            <button class="filter-tab" data-level="The Weekend">The Weekend</button>
            <button class="filter-tab" data-level="Global View">Global View</button>
        </div>

        <div class="episodes-grid" id="episodesGrid"></div>

        <div class="episode-detail" id="episodeDetail" style="display: none;">
            <button class="close-btn" id="closeBtn">‚úï Close</button>
            
            <div class="detail-header">
                <span class="detail-level" id="detailLevel">Elementary</span>
                <h2 id="detailTitle">Difficult Customer</h2>
            </div>

            <div class="tabs-section">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="transcript">Transcript</button>
                    <button class="tab-btn" data-tab="vocab">Vocab</button>
                    <button class="tab-btn" data-tab="practice">üé§ Practice</button>
                </div>
                
                <div class="tab-content active" id="transcriptTab">
                    <button class="show-btn" id="showTranscriptBtn">üëÅ Show</button>
                    <div class="content-area" id="transcriptContent" style="display: none;">
                        <p>Click "Show" to view the transcript.</p>
                    </div>
                </div>
                
                <div class="tab-content" id="vocabTab">
                    <button class="show-btn" id="showVocabBtn">üëÅ Show</button>
                    <div class="content-area" id="vocabContent" style="display: none;">
                        <p>Click "Show" to view the vocabulary.</p>
                    </div>
                </div>
                
                <div class="tab-content" id="practiceTab">
                    <div class="practice-container">
                        <div class="practice-header">
                            <h3>üé§ Pronunciation Practice</h3>
                            <p>Practice single lines, full dialogues, or vocabulary</p>
                        </div>
                        
                        <div class="practice-mode-selector">
                            <button class="mode-btn active" data-mode="single">Single Line</button>
                            <button class="mode-btn" data-mode="dialogue">Full Dialogue</button>
                            <button class="mode-btn" data-mode="roleplay">Role Play</button>
                        </div>
                        
                        <div id="rolePlaySetup" style="display: none;">
                            <div class="role-selector">
                                <!-- Buttons will be dynamically generated based on speakers -->
                            </div>
                            <p class="role-instruction" style="text-align: center; margin-top: 15px; font-size: 13px; opacity: 0.7;">
                                üí° You speak your lines, then the system will automatically speak the other character's lines
                            </p>
                        </div>
                        
                        <div class="practice-text" id="practiceText">
                            <p style="opacity: 0.6;">Select a line from transcript or click "Full Dialogue" mode...</p>
                        </div>
                        
                        <div class="practice-controls">
                            <button class="practice-btn" id="recordBtn" disabled>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                    <line x1="12" y1="19" x2="12" y2="23"/>
                                    <line x1="8" y1="23" x2="16" y2="23"/>
                                </svg>
                                <span>Record</span>
                            </button>
                            
                            <button class="practice-btn" id="playOriginalBtn" disabled>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="5 3 19 12 5 21 5 3"/>
                                </svg>
                                <span>Play Original</span>
                            </button>
                            
                            <button class="practice-btn" id="playRecordingBtn" disabled>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="5 3 19 12 5 21 5 3"/>
                                </svg>
                                <span>Play My Recording</span>
                            </button>
                        </div>
                        
                        <div class="recording-status" id="recordingStatus"></div>
                        
                        <div class="pronunciation-score" id="pronunciationScore" style="display: none;">
                            <div class="score-circle">
                                <span class="score-value" id="scoreValue">0</span>
                                <span class="score-label">/ 100</span>
                            </div>
                            <div class="score-feedback" id="scoreFeedback"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="audio-section">
                <audio id="audioPlayer" preload="metadata" style="display: none;">
                    <source src="" type="audio/mpeg">
                </audio>
                
                <div class="custom-player">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-filled" id="progressFilled"></div>
                        </div>
                        <div class="time-display">
                            <span id="currentTime">0:00</span>
                            <span class="separator">/</span>
                            <span id="duration">0:00</span>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <div class="volume-control">
                            <button class="control-btn" id="volumeBtn" title="Volume">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="volume-high-icon">
                                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                                </svg>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="volume-muted-icon" style="display: none;">
                                    <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
                                </svg>
                            </button>
                            <div class="volume-slider" style="display: none;">
                                <input type="range" id="volumeSlider" min="0" max="100" value="100">
                                <span class="volume-percentage">100%</span>
                            </div>
                        </div>
                        
                        <div class="controls-left">
                            <button class="control-btn" id="prevBtn" title="Previous Episode" aria-label="Previous Episode">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                                </svg>
                            </button>
                        </div>
                        
                        <button class="control-btn play-btn" id="playBtn" title="Play/Pause">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="play-icon">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="pause-icon" style="display: none;">
                                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                            </svg>
                            <span class="loading-spinner" style="display: none;">‚è≥</span>
                        </button>
                        
                        <div class="controls-right">
                            <button class="control-btn" id="nextBtn" title="Next Episode" aria-label="Next Episode">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                                </svg>
                            </button>
                            
                            <button class="control-btn" id="speedBtn" title="Speed">1x</button>
                            
                            <button class="control-btn" id="repeatBtn" title="A-B Repeat">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="audio-player" id="audioPlayerContainer" style="display: none;">
            <div class="player-content">
                <div class="player-info">
                    <h3 id="currentTitle">Select an episode</h3>
                    <span id="currentLevel" class="level-badge"></span>
                </div>
                <audio id="audioPlayerBottom" controls>
                    <source src="" type="audio/mpeg">
                </audio>
            </div>
        </div>
    </div>
    </div>

    <!-- Load scripts with performance optimization -->
    <script src="episodes-index.js" defer></script>
    <script src="script.js" defer></script>
    <script>
        // Performance optimization: Hide loading screen ASAP
        window.addEventListener('DOMContentLoaded', () => {
            const loadingScreen = document.getElementById('loadingScreen');
            const appContainer = document.querySelector('.app-container');
            
            if (loadingScreen && appContainer) {
                // Remove loading screen as soon as DOM ready (much faster)
                loadingScreen.style.opacity = '0';
                appContainer.classList.add('loaded');
                setTimeout(() => loadingScreen.remove(), 300);
            }
        });
    </script>
    
    <!-- ChatGPT Assistant (lazy load when idle) -->
    <script>
        // Load chatbot resources when browser is idle
        if ('requestIdleCallback' in window) {
            requestIdleCallback(() => {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = 'chatbot.css';
                document.head.appendChild(link);
                
                const script = document.createElement('script');
                script.src = 'chatbot.js';
                document.body.appendChild(script);
            });
        } else {
            setTimeout(() => {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = 'chatbot.css';
                document.head.appendChild(link);
                
                const script = document.createElement('script');
                script.src = 'chatbot.js';
                document.body.appendChild(script);
            }, 2000);
        }
    </script>
    
    <!-- Mini Player -->
    <div class="mini-player" id="miniPlayer" style="display: none;">
        <div class="mini-player-info">
            <div class="mini-episode-number" id="miniEpisodeNumber">#1</div>
            <div class="mini-episode-details">
                <div class="mini-episode-title" id="miniEpisodeTitle">Episode Title</div>
                <div class="mini-episode-level" id="miniEpisodeLevel">Elementary</div>
            </div>
        </div>
        <div class="mini-player-controls">
            <button class="mini-control-btn" id="miniPrevBtn" aria-label="Previous Episode">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path>
                </svg>
            </button>
            <button class="mini-control-btn" id="miniPlayBtn" aria-label="Play/Pause">
                <svg class="mini-play-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                <svg class="mini-pause-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                    <rect x="6" y="4" width="4" height="16"></rect>
                    <rect x="14" y="4" width="4" height="16"></rect>
                </svg>
            </button>
            <button class="mini-control-btn" id="miniNextBtn" aria-label="Next Episode">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 18h2V6h-2zM6 18l8.5-6L6 6z"></path>
                </svg>
            </button>
            <button class="mini-control-btn" id="miniExpandBtn" aria-label="Expand player">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <polyline points="9 21 3 21 3 15"></polyline>
                    <line x1="21" y1="3" x2="14" y2="10"></line>
                    <line x1="3" y1="21" x2="10" y2="14"></line>
                </svg>
            </button>
        </div>
    </div>
    
</body>
</html>
